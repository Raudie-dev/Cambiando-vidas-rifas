{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cambiando Vidas</title>
    <link rel="stylesheet" href="{% static 'css/styles.css' %}">
    <link rel="shortcut icon" href="{% static 'images/logo-img.png' %}" type="image/x-icon">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <style>
        /* Social Media Section Styles */
.social-media-section {
  padding: 5rem 2rem;
}

.social-media-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
  gap: 3rem;
  max-width: 1200px;
  margin: 0 auto;
  padding: 2rem 0;
}

.social-media-card {
  background:   white;
  border-radius: 16px;
  padding: 2rem;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
  transition: transform 0.3s ease, box-shadow 0.3s ease;
  display: flex;
  flex-direction: column;
  gap: 1.5rem;
}

.social-media-card:hover {
  transform: translateY(-8px);
  box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
}

.social-media-header {
  display: flex;
  align-items: center;
  gap: 1rem;
  padding-bottom: 1rem;
  border-bottom: 2px solid #f0f0f0;
}

.social-media-header i {
  font-size: 2.5rem;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.social-media-header i.fa-tiktok {
  background: linear-gradient(135deg, #000000 0%, #ee1d52 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.social-media-header i.fa-instagram {
  background: linear-gradient(135deg, #f09433 0%, #e6683c 25%, #dc2743 50%, #cc2366 75%, #bc1888 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.social-media-header h3 {
  font-size: 1.75rem;
  font-weight: 700;
  color: #1a1a1a;
  margin: 0;
}

.social-media-content {
  flex: 1;
  display: flex;
  align-items: center;
  justify-content: center;
  min-height: 300px;
}

.instagram-preview {
  background: linear-gradient(135deg, #fafafa 0%, #f5f5f5 100%);
  border-radius: 12px;
  padding: 2rem;
  width: 100%;
}

.instagram-placeholder {
  text-align: center;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 1rem;
}

.instagram-placeholder i {
  font-size: 4rem;
  background: linear-gradient(135deg, #f09433 0%, #e6683c 25%, #dc2743 50%, #cc2366 75%, #bc1888 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.instagram-placeholder h4 {
  font-size: 1.5rem;
  font-weight: 700;
  color: #1a1a1a;
  margin: 0;
}

.instagram-placeholder p {
  color: #666;
  line-height: 1.6;
  max-width: 400px;
}

.instagram-stats {
  display: flex;
  gap: 2rem;
  margin-top: 1.5rem;
  flex-wrap: wrap;
  justify-content: center;
}

.stat-item {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 0.5rem;
}

.stat-item i {
  font-size: 1.5rem;
  color: #667eea;
}

.stat-item span {
  font-size: 0.875rem;
  color: #666;
  text-align: center;
}

.social-btn {
  width: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.5rem;
  padding: 1rem;
  font-size: 1.1rem;
  font-weight: 600;
  text-decoration: none;
}

.social-btn i {
  font-size: 1.25rem;
}

/* TikTok embed responsive */
.tiktok-embed {
  margin: 0 auto;
}

/* Responsive adjustments */
@media (max-width: 768px) {
  .social-media-section {
    padding: 3rem 1rem;
  }

  .social-media-grid {
    grid-template-columns: 1fr;
    gap: 2rem;
    padding: 1rem 0;
  }

  .social-media-card {
    padding: 1.5rem;
  }

  .social-media-header h3 {
    font-size: 1.5rem;
  }

  .instagram-stats {
    gap: 1rem;
  }

  .stat-item span {
    font-size: 0.75rem;
  }
}

@media (max-width: 480px) {
  .social-media-header i {
    font-size: 2rem;
  }

  .instagram-placeholder i {
    font-size: 3rem;
  }

  .instagram-placeholder h4 {
    font-size: 1.25rem;
  }

  .instagram-stats {
    flex-direction: column;
    gap: 1rem;
  }
}

    </style>
    <!-- Header -->
    <header class="header">
        <nav class="nav">
            <div class="nav-logo">
                <a href="{% url 'index' %}">
                    <img src="{% static 'images/logo-img.png' %}" class="logo-img" alt="Cambia Vidas logo">
                    Cambiando Vidas
                </a>
            </div>
            <ul class="nav-menu">
                <li><a href="{% url 'index' %}" class="active">Rifas</a></li>
                <li><a href="#como-funciona">Cómo Funciona</a></li>
                <li><a href="#quienes-somos">Quiénes Somos</a></li>
                <li><a href="#contacto">Contacto</a></li>
                <!-- Botón visible dentro del menú en dispositivos móviles -->
                <li class="nav-action">
                    <button id="navConfirmBtnMobile" class="btn-outline menu-action-btn" type="button">
                        <i class="fas fa-check-circle"></i> Consultar Ticket
                    </button>
                </li>
            </ul>
            <button class="mobile-menu-btn">
                <span></span>
                <span></span>
                <span></span>
            </button>
        </nav>
    </header>

   
    <!-- Hero Section -->
    <section class="hero">
        <div class="hero-content">
            <!-- Logo agregado -->
             <!-- Messages -->
            {% if messages %}
            <div class="container" style="max-width: 1280px; margin: 0 auto; padding: 1rem;">
                {% for message in messages %}
                <div class="alert alert-{{ message.tags }}" role="alert">
                    {{ message }}
                </div>
                {% endfor %}
            </div>
            {% endif %}
            <div class="hero-badge">
                <span class="badge-dot"></span>
                Cambiando Vidas | Rifas con impacto social
            </div>
            <div class="hero-logo-container">
                <img src="{% static 'images/cambiando-vidas.png' %}" alt="RifasApp Logo" class="hero-logo-img">
            </div>
            <h1 class="hero-title">Participa y Gana Increíbles Premios</h1>

            <p class="hero-description">
                Nuestras rifas apoyan causas sociales: con lo recaudado llevamos ayuda a quienes más lo necesitan. Participa para ganar premios y, al mismo tiempo, contribuir al cambio.
            </p>
            <div class="hero-actions">
                <a href="#rifas" class="btn-primary btn-large">Ver Rifas</a>
                <button id="heroConfirmBtn" class="btn-outline btn-large">Consultar Ticket</button>
            </div>
        </div>
    </section>

    <!-- Rifas Section -->
    <section id="rifas" class="rifas-section">
        <div class="section-header">
            <h2 class="section-title">Rifas Disponibles</h2>
            <p class="section-description">Elige una rifa, compra tus tickets y forma parte de la comunidad que transforma amor en acción.</p>
            <div class="divider"></div>
        </div>
        

        <div class="rifas-grid">
            {% for rifa in rifas %}
            {% if not rifa.has_winner %}  <!-- SOLO MOSTRAR RIFAS SIN GANADOR -->
            {% with delay=forloop.counter0|add:1 %}
            <!-- Made the entire card clickable to open modal -->
            <div class="rifa-card" data-animation-delay="{{ delay }}00" data-card-id="{{ rifa.id }}" onclick="openRaffleModal('{{ rifa.id }}')">
                {% if rifa.images %}
                <div class="rifa-image-slider">
                    <div class="slider-wrapper">
                        {% for img in rifa.images %}
                        <img src="{{ img.image.url }}" alt="{{ rifa.titulo }}" class="rifa-image {% if forloop.first %}active{% endif %}">
                        {% endfor %}
                    </div>
                    {% if rifa.images.count > 1 %}
                    <!-- Added event.stopPropagation() to prevent modal opening when clicking slider buttons -->
                    <button class="slider-btn prev-btn" onclick="event.stopPropagation(); changeSlide(this, -1)">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                    <button class="slider-btn next-btn" onclick="event.stopPropagation(); changeSlide(this, 1)">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                    {% endif %}
                </div>
                {% else %}
                <div class="rifa-image-placeholder">
                    <i class="fas fa-gift"></i>
                </div>
                {% endif %}

                <div class="rifa-content">
                    <h3 class="rifa-title">{{ rifa.titulo }}</h3>
                    <p class="rifa-price">$ {{ rifa.precio|floatformat:2 }}</p>
                    <p class="rifa-description">{{ rifa.descripcion|truncatewords:15 }}</p>
                    
                    <div class="rifa-info">
                        <div class="rifa-date">
                            <i class="fas fa-calendar"></i>
                            {{ rifa.fecha_sorteo|date:"d M Y" }}
                        </div>
                        <div class="rifa-tickets">
                            <!-- <i class="fas fa-ticket-alt"></i> -->
                            <!-- {{ rifa.tickets_sold }}/{{ rifa.total_tickets }} -->
                        </div>
                    </div>

                    <div class="rifa-progress">
                        <div class="progress-bar">
                            {% widthratio rifa.tickets_sold rifa.total_tickets 100 as fill_width %}
                            <div class="progress-fill" data-progress="{{ fill_width }}"></div>
                        </div>
                        <div class="progress-text">
                            <!-- {{ rifa.tickets_available }} tickets disponibles -->
                        </div>
                    </div>

                    <!-- Updated footer buttons to prevent modal opening and added data attributes for modal -->
                    <div class="rifa-footer">
                        {% if rifa.tickets_available > 0 %}
                                <a href="{% url 'compra_rifa' rifa.id %}" class="btn-primary" onclick="event.stopPropagation();">
                                    <i class="fas fa-shopping-cart"></i> Comprar Tickets
                                </a>
                        <button class="btn-secondary" onclick="event.stopPropagation(); openConfirmModal('{{ rifa.id }}')">
                            <i class="fas fa-check-circle"></i> Consultar Ticket
                        </button>
                        {% else %}
                        <button class="btn-secondary" style="flex: 1;" disabled onclick="event.stopPropagation();">
                            <i class="fas fa-times-circle"></i> Agotada
                        </button>
                        {% endif %}
                    </div>
                </div>
                
                <!-- Hidden data for modal population -->
                <div class="rifa-data" style="display: none;">
                    <span class="data-titulo">{{ rifa.titulo }}</span>
                    <span class="data-descripcion">{{ rifa.descripcion }}</span>
                    <span class="data-precio">{{ rifa.precio|floatformat:2 }}</span>
                    <span class="data-fecha">{{ rifa.fecha_sorteo|date:"d M Y" }}</span>
                    <span class="data-tickets-sold">{{ rifa.tickets_sold }}</span>
                    <span class="data-total-tickets">{{ rifa.total_tickets }}</span>
                    <span class="data-tickets-available">{{ rifa.tickets_available }}</span>
                    <span class="data-progress">{{ fill_width }}</span>
                    <span class="data-has-winner">{{ rifa.has_winner|yesno:"true,false" }}</span>  <!-- Nuevo campo -->
                    <span class="data-url">{% url 'compra_rifa' rifa.id %}</span>
                    {% if rifa.images %}
                    <div class="data-images">
                        {% for img in rifa.images %}
                        <span class="data-image-url">{{ img.image.url }}</span>
                        {% endfor %}
                    </div>
                    {% endif %}
                </div>
            </div>
            {% endwith %}
            {% endif %}  <!-- Cierre del if not has_winner -->
            {% empty %}
            <div class="empty-state">
                <i class="fas fa-inbox"></i>
                <p>No hay rifas disponibles en este momento</p>
            </div>
            {% endfor %}
        </div>

    <!-- Sección para rifas finalizadas (con ganador) -->
    {% with rifas_con_ganador=rifas|dictsort:"has_winner"|dictsortreversed:"has_winner" %}
        {% if rifas_con_ganador.0.has_winner %}
        <div class="completed-raffles-section">
            <div class="section-header">
                <h2 class="section-title">Rifas Finalizadas</h2>
                <p class="section-description">Estas rifas ya tienen ganador asignado</p>
            </div>
            <div class="completed-raffles-grid">
                {% for rifa in rifas_con_ganador %}
                {% if rifa.has_winner %}
                <div class="completed-raffle-card">
                    <!-- Imagen de la rifa -->
                    {% if rifa.images.first %}
                    <div class="completed-raffle-image">
                        <img src="{{ rifa.images.first.image.url }}" alt="{{ rifa.titulo }}">
                        <span class="winner-badge">
                            <i class="fas fa-trophy"></i> Sorteo Realizado
                        </span>
                    </div>
                    {% else %}
                    <div class="completed-raffle-image-placeholder">
                        <i class="fas fa-gift"></i>
                        <span class="winner-badge">
                            <i class="fas fa-trophy"></i> Sorteo Realizado
                        </span>
                    </div>
                    {% endif %}
                    
                    <!-- Contenido de la tarjeta -->
                    <div class="completed-raffle-content">
                        <div class="completed-raffle-header">
                            <h4>{{ rifa.titulo }}</h4>
                        </div>
                        <div class="completed-raffle-info">
                            <p>
                                <i class="fas fa-calendar-check"></i>
                                <strong>Fecha del sorteo:</strong> {{ rifa.fecha_sorteo|date:"d M Y" }}
                            </p>
                            <p>
                                <i class="fas fa-check-circle"></i>
                                <strong>Estado:</strong> Ganador asignado
                            </p>
                        </div>
                        <!-- <button class="btn-outline" onclick="viewRaffleDetails('{{ rifa.id }}')">
                            <i class="fas fa-eye"></i> Ver Detalles
                        </button> -->
                    </div>
                </div>
                {% endif %}
                {% endfor %}
            </div>
        </div>
        {% endif %}
    {% endwith %}
    </section>

    <!-- Cómo Funciona Section -->
    <section class="how-it-works" id="como-funciona">
        <div class="section-header">
            <h2 class="section-title">Cómo Funciona</h2>
            <p class="section-description">Participar es fácil y seguro en solo 3 pasos</p>
        </div>
        <div class="steps-grid">
            <div class="step-card">
                <div class="step-number">1</div>
                <div class="step-icon">
                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="3" width="18" height="18" rx="2"/>
                        <path d="M9 3v18M15 3v18M3 9h18M3 15h18"/>
                    </svg>
                </div>
                <h3 class="step-title">Elige tu Rifa</h3>
                <p class="step-description">Explora las rifas activas y selecciona la que más te guste. Revisa los premios, precios y fechas de sorteo.</p>
            </div>
            <div class="step-card">
                <div class="step-number">2</div>
                <div class="step-icon">
                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="2" y="5" width="20" height="14" rx="2"/>
                        <path d="M2 10h20"/>
                    </svg>
                </div>
                <h3 class="step-title">Compra y registra tus Tickets</h3>
                <p class="step-description">Selecciona la cantidad de tickets que deseas. Más tickets = más oportunidades de ganar.</p>
            </div>
            <div class="step-card">
                <div class="step-number">3</div>
                <div class="step-icon">
                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                        <polyline points="22 4 12 14.01 9 11.01"/>
                    </svg>
                </div>
                <h3 class="step-title">Espera el Sorteo</h3>
                <p class="step-description">Sigue el progreso en tiempo real. Te notificaremos si eres el ganador. ¡Así de simple!</p>
            </div>
        </div>
    </section>

    <!-- Redesigned Quiénes Somos section -->
    <section id="quienes-somos" class="about-section">
        <div class="section-header">
            <h2 class="section-title">Quiénes Somos</h2>
            <div class="about-badge">
                    <i class="fas fa-certificate"></i>
                    <span>Conoces mas Sobre Nosotros</span>
            </div>
        </div>
        <div class="about-content">
            <div class="about-text">        
                <h3 class="about-subtitle">Cambiando Vidas <br>
                    Rifas que generan impacto</h3>
                
                <p class="about-paragraph">
                    En Cambia Vidas organizamos rifas transparentes y seguras con un objetivo claro: apoyar
                    proyectos y familias que necesitan una mano amiga. Cada boleto que compras contribuye directamente
                    a programas sociales, entrega de ayuda y proyectos comunitarios. Únete a nuestra comunidad y
                    conviértete en parte del cambio.
                </p>

                <p style="font-weight: 700; font-size: 1.5rem;">
                    Cada rifa que realizamos tiene un fin mucho más grande que ganar un premio
                </p>
       
                <div class="about-features">
                    <div class="about-feature-item">
                        <div class="about-feature-icon">
                            <i class="fas fa-shield-alt"></i>
                        </div>
                        <div class="about-feature-content">
                            <h4>100% Seguro</h4>
                            <p>Transacciones protegidas y datos encriptados con tecnología de última generación</p>
                        </div>
                    </div>
                    <div class="about-feature-item">
                        <div class="about-feature-icon">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <div class="about-feature-content">
                            <h4>Transparencia Total</h4>
                            <p>Sorteos verificables y resultados públicos accesibles para todos</p>
                        </div>
                    </div>
                    <div class="about-feature-item">
                        <div class="about-feature-icon">
                            <i class="fas fa-headset"></i>
                        </div>
                        <div class="about-feature-content">
                            <h4>Soporte 24/7</h4>
                            <p>Atención al cliente siempre disponible para resolver tus dudas</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="about-image">
                <div class="about-image-wrapper">
                    <img src="https://images.ecestaticos.com/0heyD9gpC4g4bWgAd-9MmpLTaN4=/0x0:1254x836/1200x900/filters:fill(white):format(jpg)/f.elconfidencial.com%2Foriginal%2Faef%2Fa91%2Fdeb%2Faefa91debc6fa3c745636a3d329f91e2.jpg" alt="Equipo RifasApp">
                </div>
            </div>
        </div>
    </section>
 
     <!-- Social Media Section -->
    <section id="redes-sociales" class="social-media-section">
        <div class="section-header">
            <h2 class="section-title">Síguenos en Redes Sociales</h2>
            <p class="section-description">Mantente al día con nuestras rifas, sorteos y las historias de quienes ayudamos</p>
        </div>
        
        <div class="social-media-grid">
            <!-- TikTok Embed -->
            <div class="social-media-card">
                <div class="social-media-header">
                    <i class="fab fa-tiktok"></i>
                    <h3>TikTok</h3>
                </div>
                <div class="social-media-content">
                    <blockquote class="tiktok-embed" cite="https://www.tiktok.com/@cambiandovidas81" data-unique-id="cambiandovidas81" data-embed-type="creator" style="max-width: 780px; min-width: 288px;">
                        <section>
                          <blockquote class="tiktok-embed" cite="https://www.tiktok.com/@cambiandovidas81" data-unique-id="cambiandovidas81" data-embed-type="creator" style="max-width: 780px; min-width: 288px;" > <section> <a target="_blank" href="https://www.tiktok.com/@cambiandovidas81?refer=creator_embed">@cambiandovidas81</a> </section> </blockquote> <script async src="https://www.tiktok.com/embed.js"></script>
                        </section>
                    </blockquote>
                </div>
                <a href="https://www.tiktok.com/@cambiandovidas81" target="_blank" rel="noopener noreferrer" class="btn-primary social-btn">
                    <i class="fab fa-tiktok"></i> Visitar TikTok
                </a>
            </div>

            <!-- Instagram Card -->
            <div class="social-media-card">
                <div class="social-media-header">
                    <i class="fab fa-instagram"></i>
                    <h3>Instagram</h3>
                </div>
                <div class="social-media-content instagram-preview">
                    <div class="instagram-placeholder">
                        <i class="fab fa-instagram"></i>
                        <h4>@cambiandovidas81</h4>
                        <p>Síguenos para ver nuestras historias, sorteos en vivo y el impacto que generamos juntos en la comunidad.</p>
                        <div class="instagram-stats">
                            <div class="stat-item">
                                <i class="fas fa-images"></i>
                                <span>Publicaciones diarias</span>
                            </div>
                            <div class="stat-item">
                                <i class="fas fa-video"></i>
                                <span>Sorteos en vivo</span>
                            </div>
                            <div class="stat-item">
                                <i class="fas fa-heart"></i>
                                <span>Historias de impacto</span>
                            </div>
                        </div>
                    </div>
                </div>
                <a href="https://www.instagram.com/cambiandovidas81" target="_blank" rel="noopener noreferrer" class="btn-primary social-btn">
                    <i class="fab fa-instagram"></i> Visitar Instagram
                </a>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer id="contacto" class="footer">
            <div class="footer-content">
            <div class="footer-section">
                <div class="footer-logo">
                    <img src="{% static 'images/logo-img.png' %}" class="logo-img" alt="Cambia Vidas logo">
                    Cambiando Vidas
                </div>
                <p class="footer-description">
                    Cada rifa ayuda a quienes más lo necesitan. Participa y transforma amor en acción.
                </p>
            </div>

            <div class="footer-section">
                <h4 class="footer-title">Enlaces</h4>
                <ul class="footer-links">
                    <li><a href="{% url 'index' %}">Rifas</a></li>
                    <li><a href="#como-funciona">Cómo Funciona</a></li>
                    <li><a href="#quienes-somos">Quiénes Somos</a></li>
                    <li><a href="#contacto">Contacto</a></li>
                </ul>
            </div>

            <div class="footer-section">
                <h4 class="footer-title">Contacto</h4>
                <ul class="footer-links">
                    <li><i class="fas fa-envelope"></i> info@rifasapp.com</li>
                    <li><i class="fas fa-phone"></i> +1 234 567 890</li>
                    <li><i class="fas fa-map-marker-alt"></i> Ciudad, País</li>
                </ul>
            </div>
        </div>

        <div class="footer-bottom">
            <p>&copy; 2025 RifasApp. Todos los derechos reservados.</p>
             <div class="footer-credits">
                    Designed by <a href="https://raudie.net" target="_blank" rel="noopener">Raudie
                    <img src="{% static 'images/raudie-logo.png' %}" class="raudie-logo" alt="">
                </a>
            </div>
        </div>
    </footer>

    <!-- Modals -->

     <!-- Updated Terms and Conditions Modal with real raffle terms -->
    <div class="modal-overlay terms-modal-overlay" id="termsModal" style="display: flex;">
        <div class="modal-container terms-modal-container">
            <div class="modal-header">
                <h3 class="modal-title">
                    <i class="fas fa-file-contract"></i> Términos y Condiciones | Rifa CAMBIANDO VIDAS
                </h3>
            </div>
            <div class="modal-body terms-modal-body">
                <div class="terms-content">
                    <p style="margin-bottom: 1.5rem; font-weight: 500;">
                        Antes de participar en nuestra rifa, por favor lee y acepta los siguientes términos y condiciones:
                    </p>
                    
                    <div class="terms-section">
                        <h5><i class="fas fa-building"></i> 1. ORGANIZADOR</h5>
                        <p>La presente rifa es organizada por <strong>CAMBIANDO VIDAS</strong>, en adelante "el Organizador", con el objetivo de recaudar fondos para apoyar causas sociales y financiar proyectos comunitarios.</p>
                    </div>
                    
                    <div class="terms-section">
                        <h5><i class="fas fa-gift"></i> 2. OBJETO DE LA RIFA</h5>
                        <p>El premio consiste en una <strong>motocicleta marca EUROMOT MODELO VITANGE CAFÉ 150</strong>, completamente nueva y legal para su uso en territorio nacional.</p>
                        <p><strong>Importante:</strong> El premio no es transferible ni canjeable por dinero.</p>
                    </div>
                    
                    <div class="terms-section">
                        <h5><i class="fas fa-users"></i> 3. PARTICIPACIÓN</h5>
                        <ul style="list-style: disc; margin-left: 1.5rem; margin-top: 0.5rem;">
                            <li>Podrán participar todas las personas mayores de 18 años, con residencia en <strong>CHILE</strong>.</li>
                            <li>La compra de un número o ticket implica la aceptación total de estos Términos y Condiciones.</li>
                            <li>Cada número tiene un costo de <strong>$1.000 CLP</strong> y puede adquirirse a través de <strong>TRANSFERENCIA BANCARIA</strong>.</li>
                            <li><strong>No se aceptarán devoluciones, reembolsos ni cambios de número</strong> una vez realizada la compra.</li>
                        </ul>
                    </div>
                    
                    <div class="terms-section">
                        <h5><i class="fas fa-calendar-alt"></i> 4. FECHA DEL SORTEO</h5>
                        <p>El sorteo se realizará al completar el <strong>80% de tickets vendidos</strong>.</p>
                        <p>Los resultados serán establecidos por la <strong>lotería nacional (LOTO)</strong>.</p>
                    </div>
                    
                    <div class="terms-section">
                        <h5><i class="fas fa-dice"></i> 5. MECÁNICA DEL SORTEO</h5>
                        <ul style="list-style: disc; margin-left: 1.5rem; margin-top: 0.5rem;">
                            <li>El número ganador será aquel que coincida con los <strong>primeros 4 dígitos</strong> del sorteo al azar en transmisión en vivo.</li>
                            <li>Si el número ganador no ha sido vendido, se repetirá el sorteo o se utilizará el método alternativo que será informado públicamente por el Organizador.</li>
                            <li>El sorteo será <strong>transparente y público</strong>, transmitido en vivo desde la cuenta oficial.</li>
                        </ul>
                    </div>
                    
                    <div class="terms-section">
                        <h5><i class="fas fa-trophy"></i> 6. ENTREGA DEL PREMIO</h5>
                        <ul style="list-style: disc; margin-left: 1.5rem; margin-top: 0.5rem;">
                            <li>El ganador será contactado dentro de las <strong>48 horas posteriores</strong> al sorteo.</li>
                            <li>El premio deberá ser retirado en <strong>SANTIAGO DE CHILE</strong>, previa validación de identidad y comprobante del número ganador.</li>
                        </ul>
                    </div>

                    <div class="terms-section">
                        <h5><i class="fas fa-shield-alt"></i> 7. PROTECCIÓN DE DATOS</h5>
                        <p>Tus datos personales serán utilizados únicamente para gestionar tu participación en las rifas y contactarte en caso de resultar ganador. No compartiremos tu información con terceros.</p>
                    </div>

                    <div class="terms-section">
                        <h5><i class="fas fa-gavel"></i> 8. RESPONSABILIDAD</h5>
                        <p>CAMBIANDO VIDAS se reserva el derecho de modificar o cancelar rifas en caso de circunstancias extraordinarias. Los participantes serán notificados oportunamente.</p>
                    </div>

                    <div style="margin-top: 1.5rem; padding: 1rem; background: rgba(255, 193, 7, 0.1); border-left: 4px solid #ffc107; border-radius: 4px;">
                        <p style="margin: 0; font-weight: 500;">
                            <i class="fas fa-exclamation-triangle" style="color: #ffc107;"></i>
                            Al hacer clic en "Acepto los Términos", confirmas que has leído, entendido y aceptas todos los términos y condiciones aquí establecidos.
                        </p>
                    </div>
                </div>
            </div>
            <div class="modal-footer terms-modal-footer">
                <button class="btn-secondary" onclick="rejectTerms()">
                    <i class="fas fa-times"></i> No Acepto
                </button>
                <button class="btn-primary" onclick="acceptTerms()">
                    <i class="fas fa-check"></i> Acepto los Términos
                </button>
            </div>
        </div>
    </div>
    <!-- Added new raffle detail modal -->
    <div class="modal-overlay" id="raffleDetailModal">
        <div class="modal-container raffle-detail-modal">
            <div class="modal-header">
                <h3 class="modal-title" id="raffleModalTitle">Detalles de la Rifa</h3>
                <button class="modal-close" onclick="closeRaffleModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <!-- Prize Images Carousel -->
                <div class="raffle-modal-carousel" id="raffleModalCarousel">
                    <div class="carousel-wrapper" id="raffleModalCarouselWrapper">
                        <!-- Images will be populated by JavaScript -->
                    </div>
                    <button class="slider-btn prev-btn" id="modalPrevBtn" style="display: none;" onclick="changeModalSlide(-1)">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                    <button class="slider-btn next-btn" id="modalNextBtn" style="display: none;" onclick="changeModalSlide(1)">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                    <div class="carousel-indicators" id="modalCarouselIndicators"></div>
                </div>

                <!-- Raffle Information -->
                <div class="raffle-modal-info">
                    <div class="raffle-modal-price">
                        <i class="fas fa-tag"></i>
                        <span>Precio por ticket:</span>
                        <strong id="raffleModalPrice">$ 0.00</strong>
                    </div>
                    
                    <div class="raffle-modal-date">
                        <i class="fas fa-calendar-alt"></i>
                        <span>Fecha del sorteo:</span>
                        <strong id="raffleModalDate">--/--/----</strong>
                    </div>

                    <div class="raffle-modal-tickets">
                        <i class="fas fa-ticket-alt"></i>
                        <span>Tickets vendidos:</span>
                        <strong id="raffleModalTickets">0/0</strong>
                    </div>

                    <div class="raffle-modal-progress">
                        <div class="progress-bar">
                            <div class="progress-fill" id="raffleModalProgressBar"></div>
                        </div>
                        <div class="progress-text" id="raffleModalAvailable">0 tickets disponibles</div>
                    </div>

                    <div class="raffle-modal-description">
                        <h4><i class="fas fa-info-circle"></i> Descripción</h4>
                        <p id="raffleModalDescription">Descripción de la rifa...</p>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" onclick="closeRaffleModal()">
                    <i class="fas fa-times"></i> Cerrar
                </button>
                <a href="#" id="raffleModalBuyBtn" class="btn-primary">
                    <i class="fas fa-shopping-cart"></i> Comprar Tickets
                </a>
            </div>
        </div>
    </div>

    {% for rifa in rifas %}
    <div class="modal-overlay" id="confirmModal{{ rifa.id }}">
        <div class="modal-container">
            <div class="modal-header">
                <h3 class="modal-title">Confirmar Ticket - {{ rifa.titulo }}</h3>
                <button class="modal-close" onclick="closeModal('confirmModal{{ rifa.id }}')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="identificacionInput{{ rifa.id }}">
                        <i class="fas fa-id-card"></i>  Ingrese su número de identificación
                    </label>
                    <input type="text" id="identificacionInput{{ rifa.id }}" class="form-input" placeholder="Ejemplo: 12345678">
                    <small class="form-hint text-muted">Este número se usará para verificar su participación en el sorteo.</small>
                </div>
                <div id="statusResult{{ rifa.id }}" class="status-result"></div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" onclick="closeModal('confirmModal{{ rifa.id }}')">Cerrar</button>
                <button class="btn-primary" onclick="checkTickets('{{ rifa.id }}')">
                    <i class="fas fa-search"></i> Buscar
                </button>
            </div>
        </div>
    </div>
    {% endfor %}

    <script src="{% static 'js/main.js' %}"></script>
    <script>
    // Terms modal: show on every page load. Accept only hides for current view.
    function acceptTerms() {
        const modal = document.getElementById('termsModal');
        if (modal) modal.style.display = 'none';
        document.body.style.overflow = 'auto';
    }

    function rejectTerms() {
        window.location.href = 'https://www.google.com';
    }

    // Always show the terms modal when the page loads
    window.addEventListener('DOMContentLoaded', function() {
        const modal = document.getElementById('termsModal');
        if (modal) {
            modal.style.display = 'flex';
            document.body.style.overflow = 'hidden';
        }
    });

    // Auto-rotation interval storage
    const autoRotateIntervals = new Map();

    function changeSlide(btn, direction) {
        const card = btn.closest('.rifa-card');
        const images = card.querySelectorAll('.rifa-image');
        let currentIndex = Array.from(images).findIndex(img => img.classList.contains('active'));
        
        images[currentIndex].classList.remove('active');
        currentIndex = (currentIndex + direction + images.length) % images.length;
        images[currentIndex].classList.add('active');
        
        // Reset auto-rotation timer when manually changed
        const cardId = card.dataset.cardId;
        if (autoRotateIntervals.has(cardId)) {
            clearInterval(autoRotateIntervals.get(cardId));
            startAutoRotation(card);
        }
    }

    // Auto-rotation for raffle cards
    function startAutoRotation(card) {
        const images = card.querySelectorAll('.rifa-image');
        if (images.length <= 1) return;
        
        const cardId = card.dataset.cardId;
        
        const interval = setInterval(() => {
            let currentIndex = Array.from(images).findIndex(img => img.classList.contains('active'));
            images[currentIndex].classList.remove('active');
            currentIndex = (currentIndex + 1) % images.length;
            images[currentIndex].classList.add('active');
        }, 4000); // Change every 4 seconds
        
        autoRotateIntervals.set(cardId, interval);
    }

    function openConfirmModal(rifaId) {
        const modal = document.getElementById('confirmModal' + rifaId);
        if (modal) {
            modal.style.display = 'flex';
            document.body.style.overflow = 'hidden';
        }
    }

    function closeModal(modalId) {
        const modal = document.getElementById(modalId);
        if (modal) {
            modal.style.display = 'none';
            document.body.style.overflow = 'auto';
        }
    }

    function checkTickets(rifaId) {
        const identInput = document.getElementById('identificacionInput' + rifaId);
        const resultDiv = document.getElementById('statusResult' + rifaId);
        
        if (!identInput) return;
        
        const identificacion = identInput.value.trim();
        if (!identificacion) {
            resultDiv.innerHTML = '<div class="alert alert-error">Por favor ingrese su identificación</div>';
            return;
        }
        
        resultDiv.innerHTML = '<div class="alert alert-info"><i class="fas fa-spinner fa-spin"></i> Buscando tickets...</div>';
        
        let base = "{% url 'tickets_status' 0 %}";
        base = base.replace('/0/', '/' + rifaId + '/');
        const url = base + '?identificacion=' + encodeURIComponent(identificacion);
        
        fetch(url)
            .then(response => response.json().then(data => ({ ok: response.ok, status: response.status, data })))
            .then(({ ok, data }) => {
                if (!ok) {
                    resultDiv.innerHTML = '<div class="alert alert-error">' + (data.error || 'Error al buscar tickets') + '</div>';
                    return;
                }
                
                if (data.status === 'NO_PARTICIPANTE' || data.status === 'NO_COMPRA') {
                    resultDiv.innerHTML = '<div class="alert alert-info">' + (data.message || 'No se encontraron compras con esta identificación') + '</div>';
                    return;
                }
                
                if (data.status === 'SUCCESS') {
                    // Construir HTML con template literals correctamente formados
                    let html = `
                    <div class="alert alert-success">
                        <i class="fas fa-check-circle"></i>
                        <div class="participante-info">
                            <strong>Tickets encontrados para:</strong>
                            <div><p>${data.participante.nombre}</p></div>
                        </div>
                    </div>
                    <div class="tickets-summary">
                        <p><strong>Total de compras:</strong> ${data.total_compras}</p>
                        <p><strong>Total de tickets:</strong> ${data.total_tickets}</p>
                    </div>
                    `;

                    // Mostrar cada compra individualmente
                    data.compras.forEach((compra, index) => {
                        const ticketsText = compra.tickets.length > 0 ? compra.tickets.join(', ') : 'Sin tickets asignados';

                        html += `
                        <div class="compra-item ${compra.estado === 'CONFIRMADO' ? 'compra-confirmada' : 'compra-pendiente'}">
                            <div class="compra-header">
                                <strong>Compra #${index + 1}</strong>
                                <span class="compra-estado ${compra.estado === 'CONFIRMADO' ? 'estado-confirmado' : 'estado-pendiente'}">
                                    ${compra.estado}
                                </span>
                            </div>
                            <div class="compra-details">
                                <p><strong>Fecha:</strong> ${compra.fecha_compra}</p>
                                <p><strong>Cantidad:</strong> ${compra.cantidad} tickets</p>
                                <p><strong>Método de pago:</strong> ${compra.metodo_pago}</p>
                                <p><strong>Referencia:</strong> ${compra.referencia}</p>
                                <p><strong>Monto:</strong> $ ${compra.monto_total}</p>
                                ${compra.tickets.length > 0 ? `<p><strong>Tickets asignados:</strong> ${ticketsText}</p>` : ''}
                            </div>
                        </div>
                        `;
                    });

                    // Mostrar todos los tickets juntos
                    if (data.tickets_totales && data.tickets_totales.length > 0) {
                        html += `
                        <div class="all-tickets-summary">
                            <h4><i class="fas fa-ticket-alt"></i> Todos tus tickets:</h4>
                            <div class="tickets-list">
                                ${data.tickets_totales.join(', ')}
                            </div>
                        </div>
                        `;
                    }

                    resultDiv.innerHTML = html;
                } else {
                    resultDiv.innerHTML = '<div class="alert alert-warning">Estado: ' + (data.status || 'DESCONOCIDO') + (data.message ? ' - ' + data.message : '') + '</div>';
                }
            })
            .catch(err => {
                console.error(err);
                resultDiv.innerHTML = '<div class="alert alert-error">Error de conexión. Por favor intente nuevamente.</div>';
            });
    }
    function openRaffleModal(rifaId) {
        const modal = document.getElementById('raffleDetailModal');
        if (modal) {
            modal.style.display = 'flex';
            document.body.style.overflow = 'hidden';
            populateRaffleModal(rifaId);
        }
    }

    function closeRaffleModal() {
        const modal = document.getElementById('raffleDetailModal');
        if (modal) {
            modal.style.display = 'none';
            document.body.style.overflow = 'auto';
        }
    }

    function populateRaffleModal(rifaId) {
        const rifaCard = document.querySelector(`[data-card-id="${rifaId}"]`);
        if (!rifaCard) return;

        const data = rifaCard.querySelector('.rifa-data');
        if (!data) return;

        const title = data.querySelector('.data-titulo').textContent;
        const description = data.querySelector('.data-descripcion').textContent;
        const price = data.querySelector('.data-precio').textContent;
        const date = data.querySelector('.data-fecha').textContent;
        const ticketsSold = data.querySelector('.data-tickets-sold').textContent;
        const totalTickets = data.querySelector('.data-total-tickets').textContent;
        const ticketsAvailable = data.querySelector('.data-tickets-available').textContent;
        const progress = data.querySelector('.data-progress').textContent;
        const hasWinner = data.querySelector('.data-has-winner').textContent === 'true';  // Nuevo
        const url = data.querySelector('.data-url').textContent;
        const images = data.querySelectorAll('.data-image-url');

        document.getElementById('raffleModalTitle').textContent = title;
        document.getElementById('raffleModalDescription').textContent = description;
        document.getElementById('raffleModalPrice').textContent = price;
        document.getElementById('raffleModalDate').textContent = date;
        document.getElementById('raffleModalTickets').textContent = `${ticketsSold}/${totalTickets}`;
        document.getElementById('raffleModalAvailable').textContent = `${ticketsAvailable} tickets disponibles`;
        document.getElementById('raffleModalProgressBar').style.width = `${progress}%`;

        const buyBtn = document.getElementById('raffleModalBuyBtn');
        
        if (hasWinner) {
            // Deshabilitar botón de compra si hay ganador
            buyBtn.href = '#';
            buyBtn.classList.add('btn-disabled');
            buyBtn.innerHTML = '<i class="fas fa-times-circle"></i> Sorteo Realizado';
            buyBtn.onclick = function(e) {
                e.preventDefault();
                return false;
            };
            
            // Agregar mensaje de rifa finalizada
            const modalBody = document.querySelector('.raffle-modal-info');
            if (!document.querySelector('.raffle-completed-message')) {
                const completedMessage = document.createElement('div');
                completedMessage.className = 'raffle-completed-message';
                completedMessage.innerHTML = `
                    <i class="fas fa-trophy"></i>
                    <h4>¡Esta rifa ya tiene ganador!</h4>
                    <p>El sorteo de esta rifa ha sido realizado. Consulta nuestras otras rifas disponibles.</p>
                `;
                modalBody.parentNode.insertBefore(completedMessage, modalBody);
            }
        } else {
            // Habilitar botón de compra normal
            buyBtn.href = url;
            buyBtn.classList.remove('btn-disabled');
            buyBtn.innerHTML = '<i class="fas fa-shopping-cart"></i> Comprar Tickets';
            buyBtn.onclick = function(e) {
                e.preventDefault();
                const href = this.getAttribute('href');
                closeRaffleModal();
                if (href && href !== '#') {
                    setTimeout(() => { window.location.href = href; }, 50);
                }
            };
            
            // Remover mensaje de rifa finalizada si existe
            const existingMessage = document.querySelector('.raffle-completed-message');
            if (existingMessage) {
                existingMessage.remove();
            }
        }

        // Resto del código para el carrusel de imágenes...
        const carouselWrapper = document.getElementById('raffleModalCarouselWrapper');
        carouselWrapper.innerHTML = '';

        images.forEach((img, index) => {
            const imgElement = document.createElement('img');
            imgElement.src = img.textContent;
            imgElement.alt = title;
            imgElement.classList.add('carousel-image');
            imgElement.classList.toggle('active', index === 0);
            carouselWrapper.appendChild(imgElement);
        });

        const modalPrevBtn = document.getElementById('modalPrevBtn');
        const modalNextBtn = document.getElementById('modalNextBtn');
        const modalCarouselIndicators = document.getElementById('modalCarouselIndicators');

        modalPrevBtn.style.display = images.length > 1 ? 'block' : 'none';
        modalNextBtn.style.display = images.length > 1 ? 'block' : 'none';

        modalCarouselIndicators.innerHTML = '';
        images.forEach((_, index) => {
            const indicator = document.createElement('span');
            indicator.classList.add('carousel-indicator');
            indicator.classList.toggle('active', index === 0);
            indicator.addEventListener('click', () => changeModalSlide(index));
            modalCarouselIndicators.appendChild(indicator);
        });
    }

    // Función para ver detalles de rifas finalizadas
    function viewRaffleDetails(rifaId) {
        // Aquí puedes implementar qué hacer cuando se hace clic en "Ver Detalles"
        // Por ejemplo, abrir un modal con información del ganador
        alert('Esta rifa ya ha sido sorteada. Próximamente podrás ver más detalles del ganador.');
    }
    function changeModalSlide(direction) {
        const carouselWrapper = document.getElementById('raffleModalCarouselWrapper');
        const images = carouselWrapper.querySelectorAll('.carousel-image');
        const indicators = document.getElementById('modalCarouselIndicators').querySelectorAll('.carousel-indicator');
        let currentIndex = Array.from(images).findIndex(img => img.classList.contains('active'));

        images[currentIndex].classList.remove('active');
        indicators[currentIndex].classList.remove('active');

        currentIndex = (currentIndex + direction + images.length) % images.length;

        images[currentIndex].classList.add('active');
        indicators[currentIndex].classList.add('active');
    }

    document.addEventListener('DOMContentLoaded', function() {
    const navBtn = document.getElementById('navConfirmBtn');
    const heroBtn = document.getElementById('heroConfirmBtn');
    const mobileBtn = document.querySelector('.mobile-menu-btn');
    const navMenu = document.querySelector('.nav-menu');
        
        function openFirstModal() {
            const modal = document.querySelector('[id^="confirmModal"]');
            if (modal) {
                modal.style.display = 'flex';
                document.body.style.overflow = 'hidden';
            }
        }
        
        if (navBtn) navBtn.addEventListener('click', openFirstModal);
        if (heroBtn) heroBtn.addEventListener('click', openFirstModal);
        // Mobile menu CTA button
        const navConfirmBtnMobile = document.getElementById('navConfirmBtnMobile');
        if (navConfirmBtnMobile) {
            navConfirmBtnMobile.addEventListener('click', function() {
                // close the mobile menu if open
                if (navMenu && navMenu.classList.contains('open')) {
                    navMenu.classList.remove('open');
                    if (mobileBtn) mobileBtn.classList.remove('open');
                }
                openFirstModal();
            });
        }

        // Mobile menu toggle (hamburguesa)
        if (mobileBtn && navMenu) {
            mobileBtn.addEventListener('click', function() {
                const isOpen = navMenu.classList.toggle('open');
                mobileBtn.classList.toggle('open', isOpen);
            });

            // Close menu when clicking a nav link
            navMenu.querySelectorAll('a').forEach(a => {
                a.addEventListener('click', function() {
                    if (navMenu.classList.contains('open')) {
                        navMenu.classList.remove('open');
                        mobileBtn.classList.remove('open');
                    }
                });
            });
        }
        
        // Close modal on outside click
        window.addEventListener('click', function(e) {
            if (e.target.classList.contains('modal-overlay')) {
                e.target.style.display = 'none';
                document.body.style.overflow = 'auto';
            }
        });

        // Apply animation-delay and progress-fill width
        document.querySelectorAll('.rifa-card[data-animation-delay]').forEach(function(card) {
            var delayMs = card.getAttribute('data-animation-delay');
            if (delayMs) card.style.animationDelay = (delayMs.endsWith('ms') ? delayMs : (delayMs + 'ms'));
        });

        document.querySelectorAll('.progress-fill[data-progress]').forEach(function(el) {
            var w = el.getAttribute('data-progress');
            if (w !== null) el.style.width = w + '%';
        });

        // Initialize auto-rotation for all raffle cards
        document.querySelectorAll('.rifa-card').forEach(card => {
            startAutoRotation(card);
        });

        // Stop auto-rotation when hovering over a card
        document.querySelectorAll('.rifa-card').forEach(card => {
            card.addEventListener('mouseenter', () => {
                const cardId = card.dataset.cardId;
                if (autoRotateIntervals.has(cardId)) {
                    clearInterval(autoRotateIntervals.get(cardId));
                }
            });
            
            card.addEventListener('mouseleave', () => {
                startAutoRotation(card);
            });
        });
        // Open raffle detail modal when clicking on a card (but not when clicking buttons/links inside it)
        document.querySelectorAll('.rifa-card').forEach(card => {
            card.addEventListener('click', function(e) {
                if (e.target.closest('a') || e.target.closest('button') || e.target.closest('.slider-btn')) return;
                const cardId = card.getAttribute('data-card-id');
                if (cardId) openRaffleModal(cardId);
            });
        });

        // Ensure the modal buy button navigates and closes the modal reliably
        const raffleBuyBtn = document.getElementById('raffleModalBuyBtn');
        if (raffleBuyBtn) {
            raffleBuyBtn.addEventListener('click', function(e) {
                e.preventDefault();
                const href = this.getAttribute('href');
                closeRaffleModal();
                if (href && href !== '#') {
                    // small timeout to allow modal close animation (if any) then navigate
                    setTimeout(() => { window.location.href = href; }, 50);
                }
            });
        }
    });
    </script>
</body>
</html>
